import{a as I,r as g,m as T,s as P,j as D,t as u,o as c,c as l,b as n,F as k,L as C,e as f,y as i,ad as V,z as w,p as a,ae as j,g as K,af as O,ag as E,x as U,S as W,Y as z}from"./index-689421b9.js";import{f as A}from"./WeeklyMenuService-b2da1fe2.js";import{f as b,c as H,e as X,d as Y}from"./ProductConverter-9374c12d.js";import{f as q,t as J,a as Q}from"./ShoppingListService-47b0f498.js";import{f as Z}from"./RecipeService-acc31022.js";const ee={class:"week-planer"},te=n("div",{class:"week-planer-header"},[n("h1",null," Generer ukesmeny for ditt kjøleskap "),n("p",{class:"week-planer-header-description"}," Ukesmenyen er basert på hva du har i kjøleskapet ditt, og vil generere en handleliste for deg ")],-1),se={class:"week-planer-content"},ne={class:"week-planer-recipes"},oe={class:"week-planer-recipe-header"},ae={class:"week-planer-recipe-day"},re={class:"week-planer-recipe-image"},ie=["src"],ce={class:"week-planer-recipe-info"},le={class:"week-planer-recipe-name"},pe={class:"week-planer-recipe-description"},de={class:"week-planer-recipe-description"},ue=["onClick"],fe={key:0,class:"recipe-ingredients"},he={class:"week-planer-footer"},ge={class:"portions-selector"},_e={class:"portions-selector-text"},me={__name:"WeekPlaner",setup(L){const v=K(),_=I().getGroupID;let m=null;const y=g(null),p=g([]),h=g([]),d=g(2);T(async()=>{P(),await F(),await x(),await $(),await S(),console.log(p.value),D()});async function F(){try{const s=await q(_);y.value=s.data.shoppingListID}catch(s){console.log(s),s.response.status===404?u("Fant ikke handlelisten"):u("Kunne ikke hente handlelisten")}}async function S(){for(const s of p.value)for(const e of s.recipeIngredients)for(const t of h.value)if(t.name.toLowerCase().includes(e.name.toLowerCase())){e.owns=!0,e.matchingProduct=t.name,e.matchingProductID=t.productId,h.value.splice(h.value.indexOf(t),1);break}}async function x(){try{m=(await b(_)).data.fridgeId,console.log(m)}catch(s){console.log(s)}try{const s=await A(m);console.log(s.data);for(const e of s.data)p.value.push({recipeId:e.recipeDetails.recipeId,recipeName:e.recipeDetails.recipeName,recipeDescription:e.recipeDetails.recipeDescription,recipeImage:e.recipeDetails.recipeImage,recipeIngredients:await B(e.recipeDetails.recipeId),ingredientMatches:e.matchCount,displayIngredients:!1})}catch(s){console.log(s)}}async function B(s){const t=(await Z(s)).data;for(let r=0;r<t.products.length;r++){const o=t.products[r];o.unit=="STK"&&(o.unit="stk"),o.showProducts=!1,o.matchingProduct=null,o.matchingProductID=null,o.unit=="STK"&&(o.unit="stk")}return t.products}async function $(){const s=I().getGroupID;try{const e=await b(s);h.value=H(e.data)}catch(e){u("Kunne ikke hente innholdet i kjøleskapet"),console.log(e)}}function G(){d.value!=2&&(d.value-=2)}function M(){d.value!=10&&(d.value+=2)}async function N(){P();for(const s of p.value)for(const e of s.recipeIngredients)if(!e.owns)try{await R(e.ean)}catch(t){console.log(t),t.response.status===404&&u("Fant ikke handlelisten")}D(),J(),u("Handlelisten er fylt opp"),v.push("/list")}async function R(s){try{const e=await X(s);let t=e.data.data.products[0].name,r=e.data.data.products[0].image;const o={ean:parseInt(s),name:t,description:t,image:r,price:e.data.data.products[0].current_price.price};products.value.push(o),await Y(o)}catch{console.log("Product already exists in database")}try{const e=await Q(y.value,s)}catch{}}return(s,e)=>(c(),l("div",ee,[te,n("div",se,[n("div",ne,[(c(!0),l(k,null,C(p.value,(t,r)=>(c(),l("div",{key:t.recipeId,class:"week-planer-recipe"},[n("div",oe,[n("h2",ae," Dag: "+a(r+1),1)]),n("div",re,[n("img",{src:t.recipeImage,alt:"recipe image"},null,8,ie)]),n("div",ce,[n("h3",le,a(t.recipeName),1),n("p",pe," Du har "+a(t.ingredientMatches)+" av "+a(t.recipeIngredients.length)+" ingredienser fra før ",1),n("p",de,a(t.recipeDescription),1)]),n("button",{class:"week-planer-recipe-button",onClick:o=>t.displayIngredients=!t.displayIngredients},[f(i(w),{icon:t.displayIngredients?i(O):i(E)},null,8,["icon"])],8,ue),t.displayIngredients?(c(),l("div",fe,[(c(!0),l(k,null,C(t.recipeIngredients,o=>(c(),l("div",{class:"recipe-ingredient",key:o.productId},[n("span",null,a(o.name)+": "+a(o.amount)+" "+a(o.unit),1)]))),128))])):U("",!0)]))),128))])]),n("div",he,[n("div",ge,[n("button",{class:"portions-selector-button",onClick:e[0]||(e[0]=t=>G())},[f(i(w),{icon:i(V)},null,8,["icon"])]),n("span",_e,a(d.value)+" porsjoner ",1),n("button",{class:"portions-selector-button",onClick:e[1]||(e[1]=t=>M())},[f(i(w),{icon:i(j)},null,8,["icon"])])]),n("button",{class:"week-planer-footer-button",onClick:e[2]||(e[2]=t=>N())}," Fyll opp handlelisten ")])]))}};const we={class:"plan-view"},ke={__name:"PlanView",setup(L){return(v,_)=>(c(),l(k,null,[n("main",we,[f(me)]),n("footer",null,[f(z)])],64))}},Ce=W(ke,[["__scopeId","data-v-e1487f6e"]]);export{Ce as default};
