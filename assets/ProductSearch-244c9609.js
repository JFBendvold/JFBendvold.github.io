import{g as V,r as n,K as B,m as A,o as b,c as y,b as e,y as j,p as w,d as N,v as L,s as T,t as p,j as x,a as U,V as G,G as K,F as q,L as M}from"./index-689421b9.js";import{g as R,e as E,d as H,h as W,i as z,j as J,k as O}from"./ProductConverter-9374c12d.js";const Q={key:0,class:"scanner-product"},X={class:"product-image"},Y=["src"],Z={class:"product-info"},ee=e("p",{class:"label"},"Holdbarhet",-1),te={class:"product-amount"},ae=e("p",{class:"amount-unit"},"dager",-1),se=e("p",{class:"label"},"Antall",-1),oe={class:"product-amount"},ne=e("p",{class:"amount-unit"},"stk",-1),re={key:1},le=e("p",null,"Loading...",-1),ue=[le],$e={__name:"ScannerProduct",props:{ean:{type:String,required:!0}},setup(C){const k=C,_=V(),d=n(""),a=n(""),l=n(""),u=n(""),v=n(""),c=n(!0),t=async h=>{let s="stk";try{T();const o=await R(h);o.data.unit&&(s=o.data.unit),d.value=o.data.ean,a.value=o.data.name,u.value=o.data.url,m.value=o.data.expirationDate,v.value=s,c.value=!1}catch{try{let f=[],$=[];const g=await E(h);console.log(g),d.value=g.data.data.ean,a.value=g.data.data.products[0].name,u.value=g.data.data.products[0].image,f=g.data.data.allergens,v.value="stk",l.value=g.data.data.products[0].current_price.price,c.value=!1;for(let P=0;P<f.length;P++)$.push(f[P].display_name),console.log(f[P].display_name);console.log($);const S={ean:parseInt(d.value),name:a.value,description:a.value,image:u.value,price:g.data.data.products[0].current_price.price,allergies:$};console.log(S);const ye=await H(S)}catch{p("Kunne ikke finne produktet med ean"),x()}}x()},r=B(()=>({name:a.value,image:u.value,unit:v.value}));console.log(r);const i=n(1),m=n(12);A(async()=>{await t(k.ean)});function I(){i.value++}function D(){i.value>1&&i.value--}async function F(){if(i.value<1){p("Du må legge til minst 1 produkt");return}if(isNaN(i.value)||isNaN(m.value)){p("Antall og holdbarhet må være tall");return}const h={groupId:U().getGroupID,ean:k.ean,amount:i.value,days:m.value,price:l.value};console.log(h);try{const s=await W(h);console.log(s),p("La til produkt i kjøleskapet"),_.push("/list"),_.go()}catch{p("Kunne ikke legge til produkt i kjøleskapet")}_.push("/list")}return(h,s)=>c.value?(b(),y("div",re,ue)):(b(),y("div",Q,[e("div",X,[e("img",{src:j(r).image},null,8,Y)]),e("div",Z,[e("h1",null,w(j(r).name),1),e("p",null,w(k.ean),1)]),ee,e("div",te,[e("button",{class:"amount-button",onClick:s[0]||(s[0]=o=>m.value--)},"-"),N(e("input",{type:"tel",class:"amount-input","onUpdate:modelValue":s[1]||(s[1]=o=>m.value=o),length:"2"},null,512),[[L,m.value]]),ae,e("button",{class:"amount-button",onClick:s[2]||(s[2]=o=>m.value++)},"+")]),se,e("div",oe,[e("button",{class:"amount-button",onClick:D},"-"),N(e("input",{type:"tel",class:"amount-input","onUpdate:modelValue":s[3]||(s[3]=o=>i.value=o),length:"2"},null,512),[[L,i.value]]),ne,e("button",{class:"amount-button",onClick:I},"+")]),e("div",{class:"product-buttons"},[e("button",{class:"product-button",onClick:F},"Legg til i kjøleskapet")])]))}};const ce=["agurk","aubergine","avokado","blomkål","brokkoli","brusselkål","bønner","gulrot","hvitløk","kål","løk","mais","paprika","potet","rødbeter","salat","spinat","squash","tomat","selleri","sopp","asparges","erter","fennikel","grønnkål","hokkaido gresskar","hvit asparges","purre","jordskokk","kikerter","knutekål","neper","rødkål","vårløk","ananas","appelsin","aprikos","banan","blåbær","bringebær","druer","eple","røde epler","grønne epler","gule epler","fersken","jordbær","kiwi","lime","mango","melon","moreller","pære","plomme","sitron","stikkelsbær","vannmelon","granateple","kirsebær","rips","solbær"],ie={products:ce},de={class:"product-search"},pe={class:"product-search-input"},ve={class:"product-search-results"},me={class:"product-search-result-image"},ge=["src"],he={class:"product-search-result-info"},ke={class:"product-search-result-name"},_e={class:"product-search-result-ean"},fe={class:"product-search-result-button"},be=["onClick"],Ne={__name:"ProductSearch",emits:["foundProduct"],setup(C,{emit:k}){function _(c){k("foundProduct",c)}const d=n([]),a=n(""),l=n([]),u=n(0),v=n(null);return A(async()=>{d.value=ie.products,d.value=G(d.value)}),K(a,async()=>{v.value&&clearTimeout(v.value),u.value++;const c=u.value;v.value=setTimeout(async()=>{if(a.value=a.value.toLowerCase(),d.value.includes(a.value))try{const t=await z(a.value);l.value=[{name:t.data.name,image:t.data.url,ean:t.data.ean}]}catch(t){p(t)}else if(!isNaN(a.value)&&a.value.length>7)try{const t=await E(a.value);if(c===u.value&&(l.value=[{name:t.data.data.products[0].name,image:t.data.data.products[0].image,ean:t.data.data.ean}],l.value.length===0))throw new Error("Fant ingen produkter med gitt EAN")}catch(t){p(t)}else try{const t=await J(a.value);if(c===u.value&&(l.value=O(t.data.data)),l.value.length===0)throw new Error("Fant ingen produkter med gitt søkeord")}catch(t){p(t)}},600)}),(c,t)=>(b(),y("div",de,[e("div",pe,[N(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>a.value=r),placeholder:"Søk på navn eller EAN"},null,512),[[L,a.value]])]),e("div",ve,[(b(!0),y(q,null,M(l.value,r=>(b(),y("div",{class:"product-search-result",key:r.ean},[e("div",me,[e("img",{src:r.image},null,8,ge)]),e("div",he,[e("div",ke,w(r.name),1),e("div",_e,w(r.ean),1)]),e("div",fe,[e("button",{onClick:i=>_(r.ean)},"Velg",8,be)])]))),128))])]))}};export{Ne as _,$e as a};
