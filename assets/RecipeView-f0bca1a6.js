import{r as h,a as R,m as O,s as D,j as C,t as u,o,c as i,b as s,p as d,i as z,e as k,_ as E,F as m,L as v,x as p,y as g,ac as H,B as L,z as x,g as q,q as X,U as Y,T as J,Y as Q}from"./index-689421b9.js";import{f as W}from"./RecipeService-acc31022.js";import{f as Z,t as j,a as ee}from"./ShoppingListService-47b0f498.js";import{f as te,c as se,e as ne,d as oe,r as ie}from"./ProductConverter-9374c12d.js";const ce={class:"recipe"},ae={class:"recipe-header"},re={class:"recipe-header-title"},le=["src"],ue={class:"recipe-content"},de={class:"recipe-content-description"},pe={key:0,class:"recipe-content-ingredients"},he={class:"recipe-content-ingredients-title"},ge={class:"recipe-content-ingredients-list"},me=["onClick"],_e={class:"recipe-content-ingredients-list-item-amount"},fe={class:"recipe-content-ingredients-list-item-name"},ke={key:0,class:"recipe-content-ingredients-list-item-matching-product"},ve={key:1,class:"matching-product-selector"},ye={class:"matching-product-selector-header"},we=s("h3",{class:"matching-product-selector-header-title"},"Velg produkt:",-1),Pe={class:"matching-product-selector-list"},Ie=["onClick"],be=s("h4",{class:"matching-product-selector-list-item-name"},"Ingen",-1),De=[be],Ce=["onClick"],Le={class:"matching-product-selector-list-item-name"},xe={key:0,class:"recipe-footer"},Be=s("p",{class:"recipe-footer-button-text"},"Legg til i handleliste",-1),Re=s("p",{class:"recipe-footer-button-subtext"}," Manglende ingredienser blir lagt til i handlelisten ",-1),je=[Be,Re],Fe=s("p",{class:"recipe-footer-button-text"},"Lag rett",-1),Ge=s("p",{class:"recipe-footer-button-subtext"}," Alle ingrediensene vil bli fjernet fra kjøleskapet ",-1),$e=[Fe,Ge],Se={class:"recipe-guide"},Te=s("span",{class:"recipe-guide-button-text"},"Vis guide",-1),Ke={key:1,class:"recipe-guide-content"},Ve={class:"recipe-guide-content-step-title"},Ae={class:"recipe-guide-content-step-list"},Me={class:"recipe-guide-content-step-list-item-text"},Ne={__name:"Recipe",setup(F){const y=q(),w=h(null),G=R().getGroupID,_=h(!1),P=h(!1),f=h(!1),a=h({}),I=h([]),B=h([]);O(async()=>{D(),await $(),await S(),await T(),await K(),b(),C()});async function $(){try{const e=await Z(G);w.value=e.data.shoppingListID}catch(e){console.log(e),e.response.status===404?u("Fant ikke handlelisten"):u("Kunne ikke hente handlelisten")}}async function S(){const e=y.currentRoute.value.params.id,t=await W(e);a.value=t.data;for(let r=0;r<a.value.products.length;r++){const l=a.value.products[r];l.showProducts=!1,l.matchingProduct=null,l.matchingProductID=null,l.unit=="STK"&&(l.unit="stk")}console.log(a.value.products);const c=a.value.guide.split("::").filter(r=>r);B.value=c.map(r=>r.split(`
`).filter(l=>l))}async function T(){const e=R().getGroupID;try{const t=await te(e);I.value=se(t.data)}catch(t){u("Kunne ikke hente innholdet i kjøleskapet"),console.log(t)}}async function K(){for(const e of a.value.products)for(const t of I.value)if(t.name.toLowerCase().includes(e.name.toLowerCase())){e.owns=!0,e.matchingProduct=t.name,e.matchingProductID=t.productId;break}}function V(e,t){e.matchingProduct=t.name,e.matchingProductID=t.productId,e.showProducts=!1,b()}function A(e){e.matchingProduct=null,e.matchingProductID=null,e.showProducts=!1,b()}function b(){P.value=!0;for(const e of a.value.products)if(e.matchingProduct==null){P.value=!1;break}}async function M(){D();for(const e of a.value.products)if(!e.owns)try{await N(e.ean)}catch(t){console.log(t),t.response.status===404?u("Fant ikke handlelisten"):u("Kunne ikke legge til produktet i handlelisten")}C(),j(),y.push("/list")}async function N(e){try{const t=await ne(e);let n=t.data.data.products[0].name,c=t.data.data.products[0].image;const r={ean:parseInt(e),name:n,description:n,image:c,price:t.data.data.products[0].current_price.price};products.value.push(r),await oe(r)}catch{console.log("Product already exists in database")}try{const t=await ee(w.value,e)}catch{u("Kunne ikke legge til produktet i handlelisten")}}async function U(){D();let e=[];for(const t of a.value.products)t.owns&&!e.includes(t.matchingProductID)&&e.push(t.matchingProductID);console.log(e);for(const t of e)try{if((await ie(t,1)).status!=200){u("Kunne ikke fjerne produktet");return}}catch{u("Kunne ikke fjerne produktet")}f.value=!0,_.value=!0,C(),u("Alle ingrediensene er fjernet fra kjøleskapet"),j()}return(e,t)=>(o(),i("div",ce,[s("div",ae,[s("h1",re,d(a.value.name),1),s("img",{class:"recipe-header-image",src:a.value.imageUrl,alt:"Bilde av retten"},null,8,le)]),s("div",ue,[s("div",de,[s("p",null,d(a.value.description),1)]),f.value?p("",!0):(o(),i("div",pe,[s("h2",he,[z(" Ingredienser (2 porsjoner) "),k(E,{message:"Her kan du se hvilke ingredienser du har i kjøleskapet ditt. Du kan også velge hvilke produkter du vil bruke til å lage retten. Hvis du ikke har alle ingrediensene kan du legge dem til i handlelisten din."})]),s("ul",ge,[(o(!0),i(m,null,v(a.value.products,n=>(o(),i("li",{key:n.id,class:L(["recipe-content-ingredients-list-item",{"recipe-content-ingredients-list-item-owns":n.owns,"matching-product-selector-active":n.showProducts}])},[s("div",{class:"recipe-basics",onClick:c=>n.showProducts=!n.showProducts},[s("span",_e,d(n.amount)+d(n.unit),1),s("span",fe,d(n.name),1),n.matchingProduct?(o(),X(g(x),{key:0,icon:g(Y),class:"recipe-content-ingredients-list-item-check"},null,8,["icon"])):p("",!0)],8,me),n.matchingProduct?(o(),i("span",ke,"("+d(n.matchingProduct)+")",1)):p("",!0),n.showProducts?(o(),i("div",ve,[s("div",ye,[we,k(g(x),{icon:g(J),class:"matching-product-selector-header-close",onClick:c=>n.showProducts=!1},null,8,["icon","onClick"])]),s("ul",Pe,[s("li",{class:"matching-product-selector-list-item",onClick:c=>A(n)},De,8,Ie),(o(!0),i(m,null,v(I.value,c=>(o(),i("li",{key:c.id,class:L(["matching-product-selector-list-item",{"matching-product-selector-list-item-selected":n.matchingProductID==c.productId}]),onClick:r=>V(n,c)},[s("h4",Le,d(c.name),1)],10,Ce))),128))])])):p("",!0)],2))),128))])]))]),f.value?p("",!0):(o(),i("div",xe,[P.value?(o(),i(m,{key:1},[f.value?p("",!0):(o(),i("button",{key:0,class:"recipe-footer-button",onClick:t[1]||(t[1]=n=>U())},$e))],64)):(o(),i("button",{key:0,class:"recipe-footer-button",onClick:t[0]||(t[0]=n=>M())},je))])),s("div",Se,[f.value?p("",!0):(o(),i("button",{key:0,class:"recipe-guide-button",onClick:t[2]||(t[2]=n=>_.value=!_.value)},[Te,k(g(x),{icon:g(H),class:L(["recipe-guide-button-icon",{"recipe-guide-button-icon-active":_.value}])},null,8,["icon","class"])])),_.value?(o(),i("div",Ke,[(o(!0),i(m,null,v(B.value,(n,c)=>(o(),i("div",{class:"recipe-guide-content-step",key:c},[s("h3",Ve,"Steg "+d(c+1),1),s("ul",Ae,[(o(!0),i(m,null,v(n,(r,l)=>(o(),i("li",{key:l,class:"recipe-guide-content-step-list-item"},[s("span",Me,d(r),1)]))),128))])]))),128))])):p("",!0)])]))}},He={__name:"RecipeView",setup(F){return(y,w)=>(o(),i(m,null,[s("main",null,[k(Ne)]),s("footer",null,[k(Q)])],64))}};export{He as default};
